<!DOCTYPE html>
<html>
<!-- モジュールを指定 -->

<head>
    <meta charset="UTF-8">
    <title>Wijmo 5 FlexGridサンプル5</title>

    <!-- Wijmo -->
    <script src="http://cdn.wijmo.com/5.20161.154/controls/wijmo.min.js" type="text/javascript"></script>
    <link href="http://cdn.wijmo.com/5.20161.154/styles/wijmo.min.css" rel="stylesheet" type="text/css" />

    <!-- Wijmoコントロール -->
    <script src="http://cdn.wijmo.com/5.20161.154/controls/wijmo.grid.min.js" type="text/javascript"></script>
    <script src="http://cdn.wijmo.com/5.20161.154/controls/wijmo.input.min.js" type="text/javascript"></script>

    <!-- Wijmoテーマ -->
    <link href="http://cdn.wijmo.com/5.20161.154/styles/themes/wijmo.theme.modern.min.css" rel="stylesheet" type="text/css" />

    <!-- Wijmoカルチャ -->
    <script src="http://cdn.wijmo.com/5.20161.154/controls/cultures/wijmo.culture.ja.min.js " type="text/javascript"></script>

    <!-- AngularJSとWijmoのAngularディレクティブ -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.1/angular.min.js" type="text/javascript"></script>
    <script src="http://cdn.wijmo.com/5.20161.154/interop/angular/wijmo.angular.min.js" type="text/javascript"></script>


    <script type="text/javascript">
        var app = angular.module('app', ['wj']); app.controller('appCtrl', function ($scope, $timeout, $compile) { 
            

        this.get1 = function(){
            return angular.element('.asyncDirectiveResult').clone().html('<hello title="2">Taro</hello>')
        };
        this.get2 = function(){
            // var el = this.get1();
            var el = angular.element('.asyncDirectiveResult').clone().html('<hello title="3">Taro1</hello>')
            $compile(el.contents())($scope);

            var el2 = angular.element('.asyncDirectiveResult').clone().html('<hello title="4">Taro4</hello>')
            $compile(el2.contents())($scope);
            
            
        };
        

$scope.onShowing2 = function(e) {
console.log("onShowing");
};

            
$scope.test = function(popup,popup1) {

    console.log(popup.hostElement);

    console.log($scope.popup);

    // $scope.popup2 = angular.copy(popup);
    // $scope.popup3 = angular.copy(popup);

    $scope.popup.show(true);


    console.log($scope.popup.hostElement.style);
    // $scope.popup.hostElement.style = $scope.popup.hostElement.style + ";display:none;";
    $scope.popup.hostElement.style = $scope.popup.hostElement.style + ";visibility:hidden;";

    // popup1.show(false);
    // popup1.show(false);
    // popup1.show(false);

    // $('#popup3').clone()

console.log("ele11", $scope.ele11);
console.log("ele12", $scope.ele12);

    $scope.ele11 = $('.popup3').clone()
    // $scope.ele11 = $('#popup3');
    $scope.popup11 = new wijmo.input.Popup($scope.ele11);
    $scope.popup11.show(false);
    $scope.popup11.onHidden = function() {

console.log("hidden 11");

    console.log($scope.popup11);
    console.log($scope.popup12);
    
    
    
    $timeout(function () {
        // $scope.popup.hostElement.style = $scope.popup.hostElement.style + ";display:block;";

        $scope.popup.hide();
    }, 1000);    

        // $scope.popup.hide();
        
        // $scope.ele11.remove();
    

    };



    $scope.ele12 = $('.popup3').clone()
    // $scope.ele12 = $('#popup3');
    $scope.popup12 = new wijmo.input.Popup($scope.ele12);
    $scope.popup12.show(false);
    $scope.popup12.onHidden = function() {

console.log("hidden 12");

    console.log($scope.popup11);
    console.log($scope.popup12);
    // $scope.ele12.remove();

};



// var tt = new wijmo.Tooltip();
// tt.show(popup.hostElement, '偶数はエラーです。'); 

// var tt2 = new wijmo.Tooltip();

// tt2.show(popup.hostElement, '偶数はエラーです1。'); 
    
};



$scope.hiding = function() {

console.log("hiding oya");
    console.log($scope.popup11);
    console.log($scope.popup12);
    

};


$scope.hidden = function() {

console.log("hidden oya");

    console.log($scope.popup11.hostElement);
    console.log($scope.popup12.hostElement);


    console.log($scope.popup11);
    console.log($scope.popup12);

// $scope.popup11.hostElement.remove();
// $scope.popup12.hostElement.remove();

console.log("remove");
// angular.element($scope.popup11.hostElement).remove();
// angular.element($scope.popup12.hostElement).remove();

wijmo.hidePopup($scope.popup11,true);
wijmo.hidePopup($scope.popup12,true);


    console.log($scope.popup11.hostElement);
    console.log($scope.popup12.hostElement);


    console.log($scope.popup11);
    console.log($scope.popup12);


};
        
                
            
            
            
        });
        
app.directive('firstDirective', function(){
  return {
    template: 
        '<div class="popup3" style="display:none"><div>ポップアップ</div><input type="text">aaa</input><button ng-click="close()">閉じる</button></div>',
        
link: function postLink(scope, element, attrs, ctrl){       //Link関数
    
    
    
    },        
  };         
      });  
        
        
            app.directive('hello', function($compile,$timeout){
                
        return {
            
    scope: {
      title: '@'
    },

controllerAs: 'ctrl',

controller: ['$scope', function($scope){                   
      this.hello = 'Hello !';                   
    }],      
            
                templateUrl: './templt.html',
            link: function(scope, el, attr){
                // el.html('Hello ' + el.text() + ' !')

scope.test = "aaa";
                
    scope.popup11 = new wijmo.input.Popup(el);
    scope.popup11.hideTrigger = wijmo.input.PopupTrigger.None;
    scope.popup11.show(false);                

        scope.close = function() {

console.log("close");

    // $timeout(function () {
    //     // $scope.popup.hostElement.style = $scope.popup.hostElement.style + ";display:block;";

    //     scope.popup11.hide();
    // }, 1000); 

        scope.popup11.hide();


        };


                
            }
        }
    });
        
        
    </script>

</head>

<!-- bodyタグ内でMyControllerを参照 -->

<body>

    <div ng-app="app" ng-controller="appCtrl as ctrl">
        <!--
        <button ng-click="popup.show()">ポップアップを表示</button>
-->
        <button ng-click="test(popup,popup1)">ポップアップを表示</button>
        <div>
            <wj-popup control="popup" modal="true" show-trigger="None" hide-trigger="None" showing="onShowing2(e)" hiding="hiding()"
            hidden="hidden()">
                <div>ポップアップ</div>
                <div wj-tooltip="#fineprint" style="border:1px solid gray;padding:5px;">ここにマウスを乗せると<br>ツールチップが表示される</div>
                <button class="wj-hide">閉じる</button>
            </wj-popup>
            <div id="fineprint" style="display:none">
                <h3>重要</h3>
                <p>今四半期のデータは比例配分によって得られた推定値です。</p>
            </div>
        </div>


    <button ng-click="ctrl.get1()">失敗</button>
    <button ng-click="ctrl.get2()">成功</button>
    <div class="asyncDirectiveResult"></div>


<div first-directive></div>  


    </div>





</body>

</html>